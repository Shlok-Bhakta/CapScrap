<div class="grid grid-flow-row grid-cols-1 w-full">
  <div class="w-full">
    <% if notice.present? %>
      <p class="py-2 px-3 bg-background mb-5 text-primary font-medium rounded-md inline-block" id="notice"><%= notice %></p>
    <% end %>

    <div class="flex justify-between items-center mb-6">
      <h1 class="font-bold text-4xl text-text">Items</h1>
      <div class="flex justify-between items-center">
        <%= link_to "View all Items", items_path, class: "rounded-md mx-2 px-3.5 py-2.5 bg-primary hover:bg-secondary text-background block font-medium" %>
        <%= link_to "Sort by Name", items_path(sort: "description"), class: "rounded-md mx-2 px-3.5 py-2.5 bg-primary hover:bg-secondary text-background block font-medium" %>
        <%= link_to "New item", new_item_path, class: "rounded-md px-3.5 py-2.5 bg-accent hover:bg-secondary text-background block font-medium" %>
      </div>
    </div>

    <!-- üîç Single Search Bar for Both ID & Name -->
    <div class="mt-4 flex items-center gap-2">
      <label for="search-query" class="font-medium text-text">Search Items:</label>
      <input type="text" id="search-query" placeholder="Enter ID or Name..." class="border px-3 py-2 rounded-md w-1/2">
    </div>

    <!-- DataTables dependencies -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.2.2/css/dataTables.dataTables.min.css"/>
    <script type="text/javascript" src="https://cdn.datatables.net/2.2.2/js/dataTables.min.js"></script>

    <div id="items" class="min-w-full">
      <% if @items.any? %>
        <table id="items-table" class="display stripe hover row-border order-column" style="width:100%">
          <thead>
            <tr>
              <th>ID</th>
              <th>Category</th>
              <th>Description</th>
              <th>Location</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @items.each do |item| %>
              <tr>
                <td><%= item.id %></td>
                <td><%= item.category.name %></td>
                <td><%= item.description %></td>
                <td><%= item.location %></td>
                <td>
                  <%= link_to "Show", item, class: "rounded-md px-2 py-1 bg-background hover:bg-secondary inline-block font-medium text-sm text-text" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>

        <!-- üîπ Live Search Script (Filters by ID and Name) -->
        <script type="text/javascript">
          $(document).ready(function() {
            var table = $('#items-table').DataTable({
              responsive: true,
              pageLength: 10,
              lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]],
              dom: 'lrtip', // Remove default DataTables search bar
              order: [[2, 'asc']], // Sort by description by default
              language: {
                search: "", // Disables the unwanted second search bar
                lengthMenu: "Show _MENU_ items per page",
                info: "Showing _START_ to _END_ of _TOTAL_ items",
                infoEmpty: "No items found",
                paginate: {
                  first: "First",
                  last: "Last",
                  next: "Next",
                  previous: "Previous"
                }
              }
            });

            // üîç Live search functionality (Search by ID or Name)
            $('#search-query').on('keyup', function() {
              var query = this.value.toLowerCase();
              table.search(query).draw(); // Search across all columns (ID, Name, etc.)
            });
          });
        </script>

      <% else %>
        <p class="text-center my-10">No items found.</p>
      <% end %>
    </div>
  </div>
</div>
