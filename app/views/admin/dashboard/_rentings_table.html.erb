<%= turbo_frame_tag "rentings_table" do %>
  <div class="flex flex-col w-full" data-controller="renting">
    <div class="overflow-x-auto -mx-3 lg:mx-0">
      <table class="w-full min-w-[800px]">
      <thead>
        <tr class="border-b">
          <th class="p-2 text-left w-1/6 text-content" data-font-size="16">
            <%= sort_rentings_header('user', 'User', sort_field, sort_direction) %>
          </th>
          <th class="p-2 text-left w-1/4 text-content" data-font-size="16">
            <%= sort_rentings_header('item', 'Item', sort_field, sort_direction) %>
          </th>
          <th class="p-2 text-left w-1/12 text-content" data-font-size="16">
            <%= sort_rentings_header('quantity', 'Quantity', sort_field, sort_direction) %>
          </th>
          <th class="p-2 text-left w-1/6 text-content" data-font-size="16">
            <%= sort_rentings_header('checkout_date', 'Checkout Date', sort_field, sort_direction) %>
          </th>
          <th class="p-2 text-left w-1/6 text-content" data-font-size="16">
            <%= sort_rentings_header('return_date', 'Return Date', sort_field, sort_direction) %>
          </th>
          <th class="p-2 text-left w-1/12 text-content" data-font-size="16">Status</th>
          <th class="p-2 text-left w-1/12 text-content" data-font-size="16">Single Use</th>
          <th class="p-2 text-left w-20 text-content" data-font-size="16">Actions</th>
        </tr>
      </thead>
      <tbody>
      <% rentings.each do |renting| %>
        <tr class="border-b hover:bg-muted">
          <td class="p-2 text-content" data-font-size="16"><%= renting.user.email %></td>
          <td class="p-2 text-content" data-font-size="16"><%= renting.item.description %></td>
          <td class="p-2 text-content" data-font-size="16">
            <span class="quantity-text"><%= renting.quantity %></span>
            <input type="number" name="quantity" value="<%= renting.quantity %>"
                   class="hidden w-full p-1 border rounded" min="1" />
          </td>
          <td class="p-2 text-content" data-font-size="16"><%= renting.checkout_date&.strftime("%Y-%m-%d") %></td>
          <td class="p-2 text-content" data-font-size="16"><%= renting.return_date&.strftime("%Y-%m-%d") %></td>
          <td class="p-2 text-content" data-font-size="16">
            <%= form_with(url: admin_dashboard_toggle_renting_path(id: renting.id), 
                         method: :patch,
                         data: { turbo_stream: true, 
                                turbo_confirm: "Are you sure you want to change this item's status?" }) do |f| %>
              <%= f.button renting.is_returned ? 'Returned' : 'Rented',
                          class: renting.is_returned ? 'px-2 py-1 bg-confirm text-text rounded' : 'px-2 py-1 bg-secondary text-text rounded',
                          data: { disable_with: "Updating..." } %>
            <% end %>
          </td>
          <td class="p-2 text-content" data-font-size="16">
            <%= form_with(url: admin_dashboard_toggle_singleuse_path(id: renting.id), 
                         method: :patch,
                         data: { turbo_stream: true, 
                                turbo_confirm: "Are you sure you want to change this item's status?" }) do |f| %>
              <%= f.button renting.is_singleuse ? 'Yes' : 'No',
                          class: renting.is_singleuse ? 'px-2 py-1 bg-confirm text-text rounded' : 'px-2 py-1 bg-secondary text-text rounded',
                          data: { disable_with: "Updating..." } %>
            <% end %>
          </td>
          <td class="p-2 text-content" data-font-size="16">
            <div class="flex justify-end space-x-2">
              <button type="button"
                      class="text-info hover:text-info p-2"
                      data-renting-id="<%= renting.id %>"
                      data-action="renting#editRow">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
              </button>
              <button type="button"
                      class="text-error hover:text-error p-2"
                      data-renting-id="<%= renting.id %>"
                      data-action="renting#deleteRenting">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
              </button>
            </div>
          </td>
        </tr>
      <% end %>
      </tbody>
      </table>
    </div>
    
    <% if rentings.any? %>
      <%= pagination_nav(pagy) %>
    <% else %>
      <p class="text-center text-muted mt-4 text-content" data-font-size="16">No rentings found</p>
    <% end %>
  </div>
<% end %>
